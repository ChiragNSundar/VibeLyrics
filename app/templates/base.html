<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}VibeLyrics{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
        rel="stylesheet">
    <!-- Alpine.js v3 for declarative UI components -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <!-- Tailwind CSS with tw- prefix to prevent conflicts -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            prefix: 'tw-',
            important: true,
            corePlugins: {
                preflight: false,
            },
            theme: {
                extend: {
                    colors: {
                        'vibe-purple': '#8b5cf6',
                        'vibe-cyan': '#06b6d4',
                        'vibe-dark': '#0a0a0f',
                        'vibe-card': '#12121a',
                        'vibe-hover': '#1a1a25',
                    },
                    backdropBlur: {
                        xs: '2px',
                    },
                    animation: {
                        'glow': 'glow 2s ease-in-out infinite alternate',
                        'float': 'float 3s ease-in-out infinite',
                    },
                    keyframes: {
                        glow: {
                            '0%': { boxShadow: '0 0 5px rgba(139, 92, 246, 0.3)' },
                            '100%': { boxShadow: '0 0 20px rgba(139, 92, 246, 0.6), 0 0 30px rgba(6, 182, 212, 0.3)' }
                        },
                        float: {
                            '0%, 100%': { transform: 'translateY(0)' },
                            '50%': { transform: 'translateY(-5px)' }
                        }
                    },
                    boxShadow: {
                        'glow-purple': '0 0 20px rgba(139, 92, 246, 0.4)',
                        'glow-cyan': '0 0 20px rgba(6, 182, 212, 0.4)',
                    }
                }
            }
        }
    </script>
    {% block extra_css %}{% endblock %}
</head>

<body>
    <nav class="navbar tw-backdrop-blur-md tw-border-b tw-border-white/10">
        <div class="nav-brand tw-group tw-cursor-pointer">
            <span class="logo tw-transition-transform tw-duration-300 group-hover:tw-scale-110">üé§</span>
            <span
                class="brand-name tw-transition-all tw-duration-300 group-hover:tw-drop-shadow-[0_0_10px_rgba(139,92,246,0.5)]">VibeLyrics</span>
        </div>
        <div class="nav-links">
            <a href="{{ url_for('workspace.index') }}"
                class="nav-link tw-transition-all tw-duration-200 hover:tw-translate-y-[-2px] {% if request.endpoint and 'workspace' in request.endpoint %}active{% endif %}">
                <span class="icon">‚úèÔ∏è</span> Workspace
            </a>
            <a href="{{ url_for('journal.index') }}"
                class="nav-link tw-transition-all tw-duration-200 hover:tw-translate-y-[-2px] {% if request.endpoint and 'journal' in request.endpoint %}active{% endif %}">
                <span class="icon">üìì</span> Journal
            </a>
            <a href="{{ url_for('references.index') }}"
                class="nav-link tw-transition-all tw-duration-200 hover:tw-translate-y-[-2px] {% if request.endpoint and 'references' in request.endpoint %}active{% endif %}">
                <span class="icon">üìö</span> References
            </a>
            <a href="{{ url_for('education.index') }}"
                class="nav-link tw-transition-all tw-duration-200 hover:tw-translate-y-[-2px] {% if request.endpoint and 'education' in request.endpoint %}active{% endif %}">
                <span class="icon">üéì</span> Learn
            </a>
            <a href="{{ url_for('stats.index') }}"
                class="nav-link tw-transition-all tw-duration-200 hover:tw-translate-y-[-2px] {% if request.endpoint and 'stats' in request.endpoint %}active{% endif %}">
                <span class="icon">üìä</span> Stats
            </a>
            <a href="{{ url_for('settings.index') }}"
                class="nav-link tw-transition-all tw-duration-200 hover:tw-translate-y-[-2px] {% if request.endpoint and 'settings' in request.endpoint %}active{% endif %}">
                <span class="icon">‚öôÔ∏è</span> Settings
            </a>
        </div>
    </nav>

    <main class="main-content">
        {% block content %}{% endblock %}
    </main>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-spinner large"></div>
        <p class="loading-text">Loading...</p>
    </div>

    <!-- Toast Notification Container -->
    <div id="toast-container" class="toast-container"></div>

    <footer class="footer">
        <p>VibeLyrics - Collaborative Hip-Hop Lyric Writing</p>
    </footer>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script>
        // Toast notification helper
        window.showToast = function (message, type = 'info', duration = 4000) {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;

            const icons = {
                success: '‚úì',
                error: '‚úï',
                warning: '‚ö†',
                info: '‚Ñπ'
            };

            toast.innerHTML = `
                <span class="toast-icon">${icons[type] || icons.info}</span>
                <span class="toast-message">${message}</span>
                <button class="toast-close" onclick="this.parentElement.remove()">√ó</button>
            `;

            container.appendChild(toast);

            setTimeout(() => {
                toast.classList.add('removing');
                setTimeout(() => toast.remove(), 300);
            }, duration);
        };

        // Loading overlay helpers
        window.showLoading = function (text = 'Loading...') {
            const overlay = document.getElementById('loading-overlay');
            overlay.querySelector('.loading-text').textContent = text;
            overlay.classList.add('active');
        };

        window.hideLoading = function () {
            document.getElementById('loading-overlay').classList.remove('active');
        };
    </script>
    {% block extra_js %}{% endblock %}
    <!-- Service Worker Registration -->
    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/static/sw.js').then(req => {
                    console.log('Service Worker Registered');
                }).catch(err => {
                    console.log('Service Worker registration failed: ', err);
                });
            });
        }
    </script>
</body>

</html>